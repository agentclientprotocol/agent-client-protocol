---
title: "Server-to-Client Logging"
---

Author(s): [@chazcb](https://github.com/chazcb)

## Elevator pitch

> What are you proposing to change?

Add a `log` notification that allows agents to send diagnostic messages to clients without terminating operations.

JSON-RPC error responses terminate the request—the run is over. But many situations (approaching rate limit, using fallback model, retrying a failed request) warrant notifying the client *without* stopping the run. This proposal adds that capability.

## Status quo

> How do things work today and what problems does this cause?

ACP has no mechanism for agents to proactively notify clients about diagnostic information:

1. **JSON-RPC errors terminate requests**: If an agent returns an error, the run stops. There's no way to report non-fatal issues.

2. **`session/update` requires a session**: Connection-wide errors (MCP server failures, server shutting down) can't be communicated because there's no session to attach them to.

3. **Errors during long runs are invisible**: A prompt turn can run for minutes. If something goes wrong mid-run but the agent can recover, the client has no visibility.

4. **No standard severity levels**: No way to distinguish errors from warnings from informational messages.

**Real-world examples:**
- Backing model rate limited → warn the user, retry in progress
- Backing service disconnected → informational, reconnecting
- Using fallback model → informational, run continues
- Server shutting down in 5 minutes → warn all sessions

## What we propose to do about it

> What are you proposing to improve the situation?

Add a `log` notification (agent → client) that requires capability negotiation:

```json
{
  "jsonrpc": "2.0",
  "method": "log",
  "params": {
    "level": "warning",
    "message": "Backing model rate limited, retrying in 5 seconds...",
    "sessionId": "abc-123",
    "logger": "model",
    "code": -32001,
    "timestamp": "2025-01-21T10:30:00Z",
    "data": { "model": "claude-3", "retryIn": 5 }
  }
}
```

### Capability Declaration

Clients opt-in by declaring `logging` capability during `initialize`:

```json
{
  "method": "initialize",
  "params": {
    "clientCapabilities": { "logging": {} }
  }
}
```

Agents MUST NOT send `log` notifications to clients that didn't declare this capability. This ensures backward compatibility—older clients simply don't receive notifications they can't handle.

### Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `level` | `LogLevel` | Yes | RFC 5424 severity: `debug`, `info`, `notice`, `warning`, `error`, `critical`, `alert`, `emergency` |
| `message` | `string` | Yes | Human-readable message |
| `sessionId` | `SessionId` | No | Omit for connection-wide messages |
| `logger` | `string` | No | Component name (e.g., "mcp", "auth") |
| `code` | `ErrorCode` | No | Structured error code |
| `timestamp` | `string` | No | ISO 8601 timestamp |
| `data` | `object` | No | Additional structured data |
| `_meta` | `object` | No | Extensibility metadata |

### Method Naming

The method name `log` follows ACP's convention for connection-level operations (like `initialize`, `authenticate`) rather than using a namespace like `log/message`.

## Shiny future

> How will things play out once this feature exists?

1. **Real-time health visibility**: Clients can show agent status—errors in a panel, warnings in a status bar
2. **Non-fatal error reporting**: Agents can report issues without aborting runs
3. **Proactive warnings**: "Approaching rate limit" before it becomes an error
4. **Debugging**: Developers see what's happening without external infrastructure

## Frequently asked questions

### Why not use `session/update`?

Several reasons:

1. **Separation of concerns**: `SessionUpdate` represents conversation state (messages, tool calls, mode changes). Logs are diagnostic metadata, not conversation content. Mixing them forces clients to filter out logs they don't want in the conversation UI.

2. **Breaking change**: Adding a log variant to `SessionUpdate` would send logs to existing clients that don't expect them. A separate capability-gated notification is opt-in and non-breaking.

3. **Opt-in presentation**: Not all clients care about logs. A separate channel lets clients ignore them entirely without polluting the conversation stream.

4. **Connection-wide messages**: Errors can occur before any session exists (e.g., MCP server failing to connect after `initialize` but before `session/new`). `session/update` requires a `sessionId`, so it simply can't be used in these cases.

### Why not use a separate channel (stderr, separate SSE endpoint, etc.)?

1. **Transport-agnostic**: ACP works over stdio, WebSocket, HTTP, etc. A side channel like stderr only exists for stdio. A protocol-level solution works across all transports.

2. **Already connected**: Clients already have an ACP connection. Why require a separate channel just for logs?

3. **Session context**: The `sessionId` field ties logs to specific sessions. A separate channel would need to reinvent this.

4. **Capability negotiation**: ACP already has capability negotiation. A separate channel would need its own opt-in mechanism.

5. **OTEL handles heavy telemetry**: The [Agent Telemetry Export RFD](./agent-telemetry-export) covers high-volume, developer-focused observability. `log` is for low-volume, user-facing messages—different use case, belongs in-band.

### Why not return errors on `prompt()`?

The key question is: **should the run stop?**

- JSON-RPC error responses terminate the request—the run is over
- `log` notifications are independent—the run continues

Many situations (backing model rate limited, approaching context limit, using fallback model) warrant notifying the client without aborting.

Also: not all agents use `prompt()`. Some use extension methods like `_enqueue` (a notification). Notifications have no response, so there's nowhere to return an error.

### How does this relate to the [Agent Telemetry Export RFD](./agent-telemetry-export)?

They're complementary:

| | `log` notification | OTEL Telemetry |
|-|-------------------|----------------|
| **Channel** | In-band (ACP) | Out-of-band (HTTP) |
| **Audience** | End users | Developers/ops |
| **Volume** | Low (key events) | High (traces, metrics) |

Use `log` for user-facing messages. Use OTEL for observability infrastructure.

### Is this a breaking change?

**No.** Capability negotiation makes it opt-in:
- Older clients don't declare capability → don't receive notifications
- Older agents don't send notifications → nothing changes

### When should agents use `log` vs JSON-RPC errors?

| Situation | Use |
|-----------|-----|
| Request fails | JSON-RPC error (terminates request) |
| Non-fatal issue during run | `log` notification (run continues) |
| Proactive warning | `log` notification |
| Connection-wide issue | `log` notification |

Rule: If there's a pending request that should fail, use JSON-RPC error. Otherwise, use `log`.

### Why RFC 5424 log levels instead of just error/warning/info?

RFC 5424 (syslog) levels are used by MCP, most logging libraries, and observability tools. Using the same 8 levels:
- Provides familiar semantics
- Enables MCP compatibility
- Supports future use cases (debug logging, critical alerts)

Clients can always map to simpler categories in their UI.

### How does this compare to other protocols?

| Protocol | Method | Levels | Scoping |
|----------|--------|--------|---------|
| **ACP (proposed)** | `log` | RFC 5424 (8) | Optional `sessionId` |
| **[MCP](https://modelcontextprotocol.io/specification/2025-11-25/server/utilities/logging)** | `notifications/message` | RFC 5424 (8) | Server-wide only |
| **[LSP](https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#window_logMessage)** | `window/logMessage` | 5 levels | None |
| **[A2A](https://a2a-protocol.org/latest/specification/)** | None | None | Task-scoped |
| **[AG-UI](https://docs.ag-ui.com/concepts/events)** | `RunError` event | None | Run-scoped |

ACP's optional `sessionId` is unique—supports both connection-wide AND session-scoped messages.

## Revision history

- **2025-01-21**: Initial draft
